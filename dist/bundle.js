!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);i(2),i(1),i(4),i(3)},function(e,t){var i=270,n=490,s="#fff",r=110,a=10,o=90,d=10,c="rgba(0, 0, 0, 0.7)",u="#000",h="16px PT Mono",l=17,f=["Ура вы победили!","Список результатов:"],w=10,v=265,g=40,y=150,p=40,m=66,S="rgba(255, 0, 0, 1)",b="rgba(0, 0, 255, ",T=function(e,t,i,n,s,r,a){var o=r/a;e.fillStyle=n,e.beginPath(),e.moveTo(t,i);for(var d=0;d<o;d++)e.quadraticCurveTo(.8*t,i+a*d+a/2,t,i+a*d+a);e.lineTo(t+s/2,i+.96*r),e.lineTo(t+s,i+r);for(var c=o;c>0;c--)e.quadraticCurveTo(s+1.2*t,i+a*c-a/2,s+t,i+a*c-a);e.lineTo(t,i),e.fill()},P=function(e,t,i,n,s,r,a){e.fillStyle=n,e.font=s,e.textBaseline="hanging",e.fillText(r,t,i+a)};window.renderStatistics=function(e,t,_){var k=function(e){for(var t=e[0],i=1;i<e.length;i++)e[i]>t&&(t=e[i]);return t}(_);T(e,r+d,a+d,c,n,i,o),T(e,r,a,s,n,i,o),function(e,t,i,n,s,r,a){e.fillStyle=s,e.font=r,e.textBaseline="hanging";for(var o=0;o<a.length;o++)e.fillText(a[o],t+n,i+n*(o+1))}(e,v,a,l,u,h,f);for(var I=function(n){var s="Вы"!==t[n]?function(e){return e+Math.random()}(b):S,o=function(){return r+m*(n+1)+p*n},d=function(){return a+i-g},c=function(){return-y*_[n]/k};!function(e,t,i,n,s,r){e.fillStyle=n,e.fillRect(t,i,s,r)}(e,o(),d(),s,p,c()),P(e,o(),d(),u,h,t[n],w),P(e,o(),i-g+c(),u,h,Math.round(_[n]),-w)},C=0;C<t.length;C++)I(C)}},function(e,t){},function(e,t,i){"use strict";window.GameConstants={Fireball:{size:window.fireballSize||24,speed:window.getFireballSpeed||function(e){return e?2:5}},Wizard:{speed:window.wizardSpeed||2,width:window.wizardWidth||61,getHeight:window.getWizardHeight||function(e){return 1.377*e},getX:window.getWizardX||function(e){return e/3},getY:window.getWizardY||function(e){return e-100}}},window.Game=function(){var e=0,t=["Кекс","Катя","Игорь"],i=[e][0],n=0,s=1,r=0,a=1,o=1,d=2,c=4,u=8,h={};h[n]={width:61,height:84,url:"img/wizard.gif"},h[n+"-reversed"]={width:61,height:84,url:"img/wizard-reversed.gif"},h[s]={width:24,height:24,url:"img/fireball.gif"};var l={};l[n]=function(e,t,i){t.keysPressed.UP&&e.y>0&&(e.direction=e.direction&~u,e.direction=e.direction|c,e.y-=e.speed*i*2),t.keysPressed.UP||e.y<300-e.height&&(e.direction=e.direction&~c,e.direction=e.direction|u,e.y+=e.speed*i/3),t.keysPressed.LEFT&&(e.direction=e.direction&~d,e.direction=e.direction|o,e.x-=e.speed*i),t.keysPressed.RIGHT&&(e.direction=e.direction&~o,e.direction=e.direction|d,e.x+=e.speed*i),e.y<0&&(e.y=0),e.y>300-e.height&&(e.y=300-e.height),e.x<0&&(e.x=0),e.x>700-e.width&&(e.x=700-e.width)},l[s]=function(e,t,i){e.direction&o&&(e.x-=e.speed*i),e.direction&d&&(e.x+=e.speed*i),(e.x<0||e.x>700)&&(e.state=a)};var f={CONTINUE:0,WIN:1,FAIL:2,PAUSE:3,INTRO:4},w={};w[e]=function(e){return e.garbage.filter(function(e){return e.type===s}).filter(function(e){return e.x<10&&e.y>240})[0]?f.WIN:f.CONTINUE};var v={};v[e]=function(e){return e.objects.push({direction:d,height:window.GameConstants.Wizard.getHeight(window.GameConstants.Wizard.width),speed:window.GameConstants.Wizard.speed,sprite:h[n],state:r,type:n,width:window.GameConstants.Wizard.width,x:window.GameConstants.Wizard.getX(700),y:window.GameConstants.Wizard.getY(300)}),e};var g=function(e){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._pauseListener=this._pauseListener.bind(this),this.setDeactivated(!1)};g.prototype={level:i,setDeactivated:function(e){this._deactivated!==e&&(this._deactivated=e,e?this._removeGameListeners():this._initializeGameListeners())},getInitialState:function(){return{currentStatus:f.CONTINUE,garbage:[],lastUpdated:null,keysPressed:{ESC:!1,LEFT:!1,RIGHT:!1,SPACE:!1,UP:!1},levelStartTime:null,objects:[],startTime:null}},initializeLevelAndStart:function(e){(e=void 0===e||e)||!this.state?(this._imagesArePreloaded=void 0,this.state=this.getInitialState(),this.state=v[this.level](this.state)):this.state.currentStatus=f.CONTINUE,this.state.levelStartTime=Date.now(),this.state.startTime||(this.state.startTime=this.state.levelStartTime),this._preloadImagesForLevel(function(){this.render(),this._initializeGameListeners(),this.update()}.bind(this))},pauseLevel:function(e){e&&(this.state.currentStatus=e),this.state.keysPressed.ESC=!1,this.state.lastUpdated=null,this._removeGameListeners(),window.addEventListener("keydown",this._pauseListener),this._drawPauseScreen()},_pauseListener:function(e){if(32===e.keyCode&&!this._deactivated){e.preventDefault();var t=this.state.currentStatus===f.WIN||this.state.currentStatus===f.FAIL;this.initializeLevelAndStart(t),window.removeEventListener("keydown",this._pauseListener)}},_drawPauseScreen:function(){var e;switch(this.state.currentStatus){case f.WIN:if(window.renderStatistics){var t=this._generateStatistics(new Date-this.state.startTime),i=this._shuffleArray(Object.keys(t));return void window.renderStatistics(this.ctx,i,i.map(function(e){return t[e]}))}e="Вы победили Газебо!\nУра!";break;case f.FAIL:e="Вы проиграли!";break;case f.PAUSE:e="Игра на паузе!\nНажмите Пробел, чтобы продолжить";break;case f.INTRO:e="Добро пожаловать!\nНажмите Пробел для начала игры"}this._drawMessage(e)},_generateStatistics:function(e){for(var i={"Вы":e},n=0;n<t.length;n++){var s=e+(3e3*Math.random()-1500);s<1e3&&(s=1e3),i[t[n]]=s}return i},_shuffleArray:function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[i],e[i]=n}return e},_drawMessage:function(e){var t=this.ctx,i=function(e,i,n,s){t.beginPath(),t.moveTo(e,i),t.lineTo(e+10,i+s/2),t.lineTo(e,i+s),t.lineTo(e+n/2,i+s-10),t.lineTo(e+n,i+s),t.lineTo(e+n-10,i+s/2),t.lineTo(e+n,i),t.lineTo(e+n/2,i+10),t.lineTo(e,i),t.stroke(),t.closePath(),t.fill()};t.fillStyle="rgba(0, 0, 0, 0.7)",i(190,40,320,100),t.fillStyle="rgba(256, 256, 256, 1.0)",i(180,30,320,100),t.fillStyle="#000",t.font="16px PT Mono",e.split("\n").forEach(function(e,i){t.fillText(e,200,80+20*i)})},_preloadImagesForLevel:function(e){if(void 0===this._imagesArePreloaded&&(this._imagesArePreloaded=[]),this._imagesArePreloaded[this.level])e();else for(var t=Object.keys(h),i=t.length,n=this,s=function(t){var s=new Image(t.width,t.height);s.onload=function(){t.image=s,0==--i&&(n._imagesArePreloaded[n.level]=!0,e())},s.src=t.url},r=0;r<t.length;r++)s(h[t[r]])},updateObjects:function(e){var t=this.state.objects.filter(function(e){return e.type===n})[0];this.state.keysPressed.SHIFT&&(this.state.objects.push({direction:t.direction,height:window.GameConstants.Fireball.size,speed:window.GameConstants.Fireball.speed(!!(t.direction&o)),sprite:h[s],type:s,width:window.GameConstants.Fireball.size,x:t.direction&d?t.x+t.width:t.x-window.GameConstants.Fireball.size,y:t.y+t.height/2}),this.state.keysPressed.SHIFT=!1),this.state.garbage=[];var i=this.state.objects.filter(function(t){return l[t.type](t,this.state,e),t.state!==a||(this.state.garbage.push(t),!1)},this);this.state.objects=i},checkStatus:function(){if(this.state.currentStatus===f.CONTINUE){this.commonRules||(this.commonRules=[function(e){return e.objects.filter(function(e){return e.type===n})[0].state===a?f.FAIL:f.CONTINUE},function(e){return e.keysPressed.ESC?f.PAUSE:f.CONTINUE},function(e){return Date.now()-e.startTime>18e4?f.FAIL:f.CONTINUE}]);for(var e=this.commonRules.concat(w[this.level]),t=f.CONTINUE;t===f.CONTINUE&&e.length;)t=e.shift()(this.state);this.state.currentStatus=t}},setGameStatus:function(e){this.state.currentStatus!==e&&(this.state.currentStatus=e)},render:function(){this.ctx.clearRect(0,0,700,300),this.state.objects.forEach(function(e){if(e.sprite){var t=e.direction&o,i=h[e.type+(t?"-reversed":"")]||h[e.type];this.ctx.drawImage(i.image,e.x,e.y,e.width,e.height)}},this)},update:function(){this.state.lastUpdated||(this.state.lastUpdated=Date.now());var e=(Date.now()-this.state.lastUpdated)/10;switch(this.updateObjects(e),this.checkStatus(),this.state.currentStatus){case f.CONTINUE:this.state.lastUpdated=Date.now(),this.render(),requestAnimationFrame(function(){this.update()}.bind(this));break;case f.WIN:case f.FAIL:case f.PAUSE:case f.INTRO:this.pauseLevel()}},_onKeyDown:function(e){switch(e.keyCode){case 37:this.state.keysPressed.LEFT=!0;break;case 39:this.state.keysPressed.RIGHT=!0;break;case 38:this.state.keysPressed.UP=!0;break;case 27:this.state.keysPressed.ESC=!0}e.shiftKey&&(this.state.keysPressed.SHIFT=!0)},_onKeyUp:function(e){switch(e.keyCode){case 37:this.state.keysPressed.LEFT=!1;break;case 39:this.state.keysPressed.RIGHT=!1;break;case 38:this.state.keysPressed.UP=!1;break;case 27:this.state.keysPressed.ESC=!1}e.shiftKey&&(this.state.keysPressed.SHIFT=!1)},_initializeGameListeners:function(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp)},_removeGameListeners:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}},g.Verdict=f;var y=new g(document.querySelector(".demo"));return window.restartGame=function(e,t){h[n].url=e,h[n+"-reversed"].url=t,y.initializeLevelAndStart(),y.setGameStatus(f.INTRO)},window.restartGame("img/wizard.gif","img/wizard-reversed.gif"),y}()},function(e,t){document.querySelector(".setup").classList.remove("hidden")}]);